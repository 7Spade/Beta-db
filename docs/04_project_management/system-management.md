
# 「系統管理」功能 - 設計藍圖

本文件闡述了後台「系統管理」模組的設計目標與功能規劃。此模組是高階管理員用來配置和監控整個平台運作的核心區域。

## 1. 核心目標 (Core Objectives)

- **集中配置**: 提供一個統一的介面，用於管理影響整個網站行為的全域設定。
- **權限控制**: 設計並管理應用程式的角色與權限體系 (Role-Based Access Control, RBAC)。
- **系統監控**: 讓管理員能夠監控系統的健康狀況、資源使用情況和安全事件。
- **整合管理**: 管理與第三方服務（如金流、郵件服務）的整合與 API 金鑰。

## 2. 功能規劃 (Feature Breakdown)

「系統管理」模組將包含以下幾個子功能：

### 2.1. 全域設定 (Global Settings)
- **功能**: 管理不屬於任何特定內容、但影響全站的設定。
- **範例**:
  - **網站名稱與 Logo**: 設定顯示在瀏覽器標籤頁和頁首的網站名稱和 Logo 圖片。
  - **預設聯絡信箱**: 設定「聯絡我們」表單訊息要寄送到的目標信箱。
  - **維護模式**: 提供一個開關，可以一鍵將整個前台網站切換到「維護中」的頁面。
- **資料庫影響**: 建議新增一個 `system_settings` 集合，並使用一個固定的文件 ID（如 `global`）來儲存這些鍵值對。

### 2.2. 使用者與角色管理 (User & Role Management)
- **功能**: 除了現有的「審核新用戶」外，提供更細緻的權限管理。
- **規劃**:
  - **角色編輯器**: 允許高階管理員建立新的角色（如：專案經理、財務），並為每個角色勾選其擁有的權限（如：`can_create_contract`, `can_approve_payment`）。
  - **使用者指派**: 在使用者列表頁面，管理員可以為每個使用者指派不同的角色。
- **資料庫影響**:
  - 需要一個新的 `roles` 集合來儲存角色的定義和其權限列表。
  - `users` 文件中的 `role` 欄位將不再是簡單的字串，可能需要是一個關聯到 `roles` 集合的 ID。

### 2.3. 系統日誌與監控 (Logs & Monitoring)
- **功能**: 提供一個介面，讓管理員可以查看系統的底層活動。
- **規劃**:
  - **活動日誌檢視器**: 提供一個 UI 來查詢和篩選 `activity_logs` 集合中的所有紀錄。
  - **AI Token 消耗儀表板**: 專門的儀表板，用於視覺化 `aiTokenLogs` 的數據，分析哪個 AI 流程消耗最大，或哪個使用者使用最頻繁。
  - **錯誤日誌**: (未來) 整合錯誤監控服務（如 Sentry），並在此處顯示錯誤報告。

### 2.4. API 與整合管理 (API & Integrations)
- **功能**: 安全地管理與外部服務整合所需的 API 金鑰。
- **規劃**:
  - 提供一個介面，讓管理員可以更新儲存在安全環境（如 Google Secret Manager）中的金鑰，例如 Google Maps API 金鑰、郵件服務 API 金鑰等。
  - **注意**: 此介面**絕不**直接顯示金鑰內容，只提供更新的功能。

## 3. 架構影響與結構樹 (Frontend Architecture Impact)

此模組的功能將完全體現在後台。

```text
src/
└── app/
    └── (admin)/
        └── system-management/
            ├── page.tsx                <-- 系統管理主儀表板
            ├── users/
            │   └── page.tsx            <-- 使用者與角色管理頁面
            ├── settings/
            │   └── page.tsx            <-- 全域設定頁面
            ├── logs/
            │   └── page.tsx            <-- 系統日誌檢視器
            └── integrations/
                └── page.tsx            <-- API 整合管理頁面
```

```text
src/
└── components/
    └── features/
        └── system/                     <-- **新目錄**
            ├── actions/
            │   └── settings-actions.ts # 更新系統設定的 Server Actions
            ├── views/
            │   ├── global-settings-view.tsx
            │   ├── role-editor-view.tsx
            │   └── logs-viewer.tsx
            └── types/
                └── role.types.ts
```

---
**結論**: 「系統管理」是確保平台長期穩定、安全且可擴展的控制中樞。一個設計良好的系統管理模組，是平台從一個「應用」成長為一個「企業級產品」的必要條件。
